# Air Quality Observations Station

This repository holds code for an environment sensing station for Air Quality Index (AQI) reporting, complementing my earlier [weather station implementation](https://github.com/kbarrell/WeatherStn-2021). Air quality is measured by an Adafruit circuit breakout incorporating a Plantower Particle Mass Concentration Sensor PMSA003I. PM1.0, PM2.5 and PM10.0 readings from the sensor are regularly uploaded via public LoRaWAN network:  The Things Stack - Community Edition (TTS-CE), following the approach used for the earlier Weather Station development.  Uploaded data is again forwarded to TagoIO backend web system for analysis and reporting.

The development has adopted the comprehensive LoRaWAN application template, **LMIC-node**, provided by Leonel Parente's https://github.com/lnlp/LMIC-node. LMIC-node provides a very complete build environment using PlatformIO, with multi-board, multi-region (i.e. radio regulation) targets. It illustrates a robust approach to developing a node that communicates via The Things Network/TTS-CE. 

Rather than add an AQI sensor to the somewhat cramped hardware real estate of the existing weather station, the following system setup has been adopted:
- Separate controller end-device dedicated to AQI sensing/reporting:  Adafruit Feather M0 w. LoRa
- Regular (5 min interval) upload via TTS-CE of the full set of PMSA003I PM and particle count readings
- Forwarding each dataset to TagoIO for accumulation in a dedicated data Bucket, separate to that used for the main weather station data accumulation. A TagoIO Payload Parser script is used to filter out unnecessary variables (largely LoRaWAN transmission metadata) prior to starage.
- An Analysis script is then used to regularly retrieve recent PM data from the Bucket and calculate the rolling average PM2.5 measurements for both the last hour and the last 24 hours.  These calculated averages are saved back to the Bucket for subsequent retrieval by Dashboard reporting.
- The TagoIO reporting Dashboard of the weather station has been extended to display current and historical avgerage PM2.5 readings.  While drawn from the separate AQI data Bucket, the data is presented within the single weather station dashboaed.

The operational dashboards of the weather station incorporating AQI readout generated by this system can be viewed at either:

- TagoIO:  [Winston-weather](https://admin.tago.io/public/dashboard/5f6c6b591495bd001c4570af/99644dbe-227d-4bbd-a4c6-f63629c97dbd), or
- Weather Underground:  [Winston-01](https://www.wunderground.com/dashboard/pws/IMELBO2422)
